<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор договора аренды квартиры</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Шапка -->
        <header class="header">
            <h1><i class="fas fa-file-contract"></i> Генератор договора аренды</h1>
            <p class="subtitle">Загрузите фото паспорта для автоматического заполнения данных</p>
        </header>

        <!-- Прогресс бар -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Загрузка паспорта</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Заполнение данных</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Договор</div>
                </div>
            </div>
        </div>

        <!-- Шаг 1: Загрузка паспорта -->
        <section id="step1" class="step-section active">
            <h2><i class="fas fa-camera"></i> Шаг 1: Загрузите фото паспорта</h2>
            
            <div class="upload-options">
                <div class="upload-card" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <h3>Загрузить файл</h3>
                    <p>Выберите фото с устройства</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="upload-card" onclick="openCamera()">
                    <div class="upload-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h3>Сделать фото</h3>
                    <p>Используйте камеру телефона</p>
                </div>
                
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
            </div>

            <div class="preview-container" id="previewContainer" style="display: none;">
                <div class="preview-header">
                    <h3>Предпросмотр</h3>
                    <button class="btn-small" onclick="clearPreview()">
                        <i class="fas fa-times"></i> Удалить
                    </button>
                </div>
                <img id="imagePreview" alt="Предпросмотр документа">
                <div class="preview-actions">
                    <button class="btn-secondary" onclick="clearPreview()">
                        <i class="fas fa-redo"></i> Загрузить другой
                    </button>
                    <button class="btn-primary" onclick="recognizeText()">
                        <i class="fas fa-search"></i> Распознать текст
                    </button>
                </div>
            </div>

            <div class="or-divider">
                <span>или</span>
            </div>

            <button class="btn-primary large" onclick="skipToManual()">
                <i class="fas fa-keyboard"></i> Ввести данные вручную
            </button>

            <div class="tips">
                <h4><i class="fas fa-lightbulb"></i> Советы для лучшего распознавания:</h4>
                <ul>
                    <li><i class="fas fa-check-circle"></i> Сфотографируйте разворот паспорта с данными</li>
                    <li><i class="fas fa-check-circle"></i> Убедитесь в хорошем освещении</li>
                    <li><i class="fas fa-check-circle"></i> Держите камеру прямо над документом</li>
                    <li><i class="fas fa-check-circle"></i> Избегайте бликов и теней</li>
                </ul>
            </div>
        </section>

        <!-- Шаг 2: Заполнение данных -->
        <section id="step2" class="step-section">
            <h2><i class="fas fa-edit"></i> Шаг 2: Заполните данные для договора</h2>
            
            <div class="form-container">
                <!-- Данные арендодателя -->
                <div class="form-section">
                    <h3><i class="fas fa-user-tie"></i> Данные арендодателя (собственника)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="landlordName">ФИО полностью *</label>
                            <input type="text" id="landlordName" placeholder="Любимова Ольга Викторовна" required>
                        </div>
                        <div class="form-group">
                            <label for="landlordPassport">Паспорт (серия номер) *</label>
                            <input type="text" id="landlordPassport" placeholder="4512 123456" required>
                        </div>
                        <div class="form-group full-width">
                            <label for="landlordIssuedBy">Кем выдан *</label>
                            <input type="text" id="landlordIssuedBy" placeholder="ОВД района Теплый Стан г. Москвы" required>
                        </div>
                        <div class="form-group">
                            <label for="landlordIssueDate">Дата выдачи *</label>
                            <input type="date" id="landlordIssueDate" required>
                        </div>
                        <div class="form-group">
                            <label for="landlordDivisionCode">Код подразделения *</label>
                            <input type="text" id="landlordDivisionCode" placeholder="770-001" required>
                        </div>
                        <div class="form-group full-width">
                            <label for="landlordRegistration">Адрес регистрации *</label>
                            <input type="text" id="landlordRegistration" placeholder="г. Москва, ул. Примерная, д. 1, кв. 1" required>
                        </div>
                    </div>
                </div>

                <!-- Данные арендатора -->
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> Данные арендатора</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tenantName">ФИО полностью *</label>
                            <input type="text" id="tenantName" placeholder="Хайтбаева Янгилжан Ускиновна" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantPassport">Паспорт (серия номер) *</label>
                            <input type="text" id="tenantPassport" placeholder="4512 654321" required>
                        </div>
                        <div class="form-group full-width">
                            <label for="tenantIssuedBy">Кем выдан *</label>
                            <input type="text" id="tenantIssuedBy" placeholder="Отделом УФМС России по г. Москве" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantIssueDate">Дата выдачи *</label>
                            <input type="date" id="tenantIssueDate" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantDivisionCode">Код подразделения *</label>
                            <input type="text" id="tenantDivisionCode" placeholder="770-002" required>
                        </div>
                        <div class="form-group full-width">
                            <label for="tenantRegistration">Адрес регистрации *</label>
                            <input type="text" id="tenantRegistration" placeholder="г. Москва, пр. Вернадского, д. 78, кв. 45" required>
                        </div>
                    </div>
                </div>

                <!-- Данные квартиры -->
                <div class="form-section">
                    <h3><i class="fas fa-home"></i> Данные квартиры</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="apartmentAddress">Адрес квартиры *</label>
                            <input type="text" id="apartmentAddress" value="г. Москва, Волгоградский проспект дом 164 корп. 3, кв. 22" required>
                        </div>
                        <div class="form-group">
                            <label for="apartmentArea">Площадь (кв.м) *</label>
                            <input type="number" id="apartmentArea" value="58" required>
                        </div>
                        <div class="form-group">
                            <label for="roomsCount">Количество комнат *</label>
                            <input type="number" id="roomsCount" value="3" required>
                        </div>
                        <div class="form-group full-width">
                            <label for="basisDocument">Основание собственности *</label>
                            <input type="text" id="basisDocument" value="Наследство по закону" required>
                        </div>
                    </div>
                </div>

                <!-- Условия аренды -->
                <div class="form-section">
                    <h3><i class="fas fa-file-contract"></i> Условия аренды</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="contractDate">Дата договора *</label>
                            <input type="date" id="contractDate" value="2025-11-22" required>
                        </div>
                        <div class="form-group">
                            <label for="rentAmount">Сумма аренды (руб/мес) *</label>
                            <input type="number" id="rentAmount" value="47000" required>
                        </div>
                        <div class="form-group">
                            <label for="depositAmount">Депозит (руб) *</label>
                            <input type="number" id="depositAmount" value="47000" required>
                        </div>
                        <div class="form-group">
                            <label for="contractStart">Начало аренды *</label>
                            <input type="date" id="contractStart" value="2025-10-01" required>
                        </div>
                        <div class="form-group">
                            <label for="contractEnd">Окончание аренды *</label>
                            <input type="date" id="contractEnd" value="2026-08-01" required>
                        </div>
                    </div>
                </div>

                <!-- Показания счетчиков -->
                <div class="form-section">
                    <h3><i class="fas fa-tachometer-alt"></i> Показания счетчиков</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="electricityCounter">Электросчетчик *</label>
                            <input type="text" id="electricityCounter" placeholder="Введите показания" required>
                            <div class="hint">Показания на дату передачи квартиры</div>
                        </div>
                        <div class="form-group">
                            <label for="hotWaterCounter">Горячая вода *</label>
                            <input type="text" id="hotWaterCounter" placeholder="Введите показания" required>
                        </div>
                        <div class="form-group">
                            <label for="coldWaterCounter">Холодная вода *</label>
                            <input type="text" id="coldWaterCounter" placeholder="Введите показания" required>
                        </div>
                    </div>
                </div>

                <!-- Проживающие лица -->
                <div class="form-section">
                    <h3><i class="fas fa-users"></i> Проживающие лица</h3>
                    <div id="residentsContainer">
                        <!-- Список проживающих будет добавлен скриптом -->
                    </div>
                    <button type="button" class="btn-secondary" onclick="addResident()">
                        <i class="fas fa-plus"></i> Добавить проживающего
                    </button>
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn-secondary" onclick="goToStep(1)">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
                <button class="btn-primary" onclick="validateAndGenerate()">
                    <i class="fas fa-file-contract"></i> Сформировать договор
                </button>
            </div>
        </section>

        <!-- Шаг 3: Предпросмотр договора -->
        <section id="step3" class="step-section">
            <h2><i class="fas fa-file-alt"></i> Шаг 3: Предпросмотр договора</h2>
            
            <div class="contract-actions">
                <button class="btn-secondary" onclick="goToStep(2)">
                    <i class="fas fa-edit"></i> Редактировать данные
                </button>
                <button class="btn-primary" onclick="downloadPDF()">
                    <i class="fas fa-download"></i> Скачать PDF
                </button>
                <button class="btn-primary" onclick="printContract()">
                    <i class="fas fa-print"></i> Печать
                </button>
            </div>

            <div class="contract-preview" id="contractPreview">
                <!-- Договор будет загружен здесь -->
            </div>

            <div class="contract-actions">
                <button class="btn-secondary" onclick="goToStep(2)">
                    <i class="fas fa-edit"></i> Редактировать данные
                </button>
                <button class="btn-primary" onclick="downloadPDF()">
                    <i class="fas fa-download"></i> Скачать PDF
                </button>
                <button class="btn-primary" onclick="printContract()">
                    <i class="fas fa-print"></i> Печать
                </button>
            </div>
        </section>

        <footer>
            <p>© 2024 Генератор договоров. Все данные обрабатываются локально в вашем браузере.</p>
        </footer>
    </div>

    <!-- Модальное окно загрузки -->
    <div id="loadingModal" class="modal">
        <div class="modal-content">
            <div class="spinner"></div>
            <h3 id="loadingText">Загрузка...</h3>
        </div>
    </div>

    <!-- Модальное окно с распознанным текстом -->
    <div id="ocrModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> Распознанный текст</h3>
                <button class="close-btn" onclick="closeOCRModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Мы распознали текст с паспорта. Вы можете скопировать нужные данные:</p>
                <div class="ocr-text" id="ocrText"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeOCRModal()">Закрыть</button>
                <button class="btn-primary" onclick="useOCRData()">Использовать данные</button>
            </div>
        </div>
    </div>

    <!-- Подключаем библиотеки -->
    <script src="https://unpkg.com/tesseract.js@v2.1.5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js"></script>
</body>
</html>